-- CREATE DATABASE 
CREATE DATABASE ASSIGNMENT7;
USE ASSIGNMENT7;

-- CREATING TABLES

CREATE TABLE COUNTRY
(
COUNTRY_ID INT AUTO_INCREMENT PRIMARY KEY,
COUNTRY_NAME VARCHAR(100),
POPULATION BIGINT,
AREA DECIMAL (10,2));

CREATE TABLE PERSONS
(
ID INT AUTO_INCREMENT PRIMARY KEY,
FNAME VARCHAR (50) NOT NULL,
LNAME VARCHAR(50),
POPULATION BIGINT,
RATING DECIMAL (3,2),
COUNTRY_ID INT,
COUNTRY_NAME VARCHAR(100));

DESC COUNTRY;
DESC PERSONS;

-- INSERTING VALUES INTO TABLE

INSERT INTO COUNTRY
VALUES 
(1, 'USA', '500000', '643801.0'),
(2, 'CANADA', '800000', '683547.4'),
(3, 'AUSTRALIA', '1000000', '45781255.0'),
(4, 'INDIA', '30000000', '3287263.0'),
(5, 'UK', '1500000', '543801.2'),
(6, 'JAPAN', '126300000', '377975.0'),
(7, 'BRAZIL', '211000000', '8515767.0'),
(8, 'MOSCOW', '126300000', '377975.0'),
(9, 'ROME', '60245946', '301340.0'),
(10, 'OTTAWA', '37742154', '9984670.0');

SELECT * FROM COUNTRY;

INSERT INTO PERSONS
VALUES
(DEFAULT, 'JOHN', 'DOE', '500000', '1.0', '1', 'USA'),
(DEFAULT, 'SOPHIA', 'WILLIAMS', '800000', '2.0', '2', 'CANADA'),
(DEFAULT, 'JAMES', 'TAYLOR', '1000000', '3.0', '3', 'AUSTRALIA'),
(DEFAULT, 'AALIYA', 'MILLER', '30000000', '4.0', '4', 'INDIA'),
(DEFAULT, 'EMMA', 'YOUNG', '1500000', '5.0', '5', 'UK'),
(DEFAULT, 'ISABELLA', 'KING', '126300000', '2.0', '6', 'JAPAN'),
(DEFAULT, 'DANIEL', 'HALL', '211000000', '3.0', '7', 'BRAZIL'),
(DEFAULT, 'LILY', 'LEWIS', '126300000', '1.0', '8', 'MOSCOW'),
(DEFAULT, 'MIA', 'NELSON', '60245946', '4.0', '9', 'ROME'),
(DEFAULT, 'MILA', 'MURPHY', '37742154', '5.0', '10', 'OTTAWA');

SELECT * FROM PERSONS;

#1. ADD A NEW COLUMN CALLED DOB IN PERSONS TABLE WITH DATA TYPE AS DATE
ALTER TABLE PERSONS
ADD COLUMN DOB DATE;

#2. USER DEFINED FUNCTION TO CALCULATE AGE USING DOB

DELIMITER $$

CREATE FUNCTION calculate_age(DOB DATE)
RETURNS INT
DETERMINISTIC
BEGIN
DECLARE age INT;

-- Calculate the age by finding the difference in years between the current date and DOB
SET age = TIMESTAMPDIFF(YEAR, dob, CURDATE());
IF DATE_FORMAT(dob, '%m-%d') > DATE_FORMAT(CURDATE(), '%m-%d') THEN
SET age = age - 1;
END IF;

RETURN age;
END $$
DELIMITER ;

#3. WRITE A SELECT QUERY TO FETCH AGE OF ALL PERSONS USING A FUNCTION THAT HAS BEEN CREATED
SELECT FNAME, DOB, CALCULATE_AGE(DOB) AS AGE FROM PERSONS;

#4. FIND THE LENGTH OF EACH COUNTRY NAME IN THE COUNTRY TABLE
SELECT COUNTRY_NAME, LENGTH(COUNTRY_NAME) AS COUNTRY_NAME_LENGTH FROM COUNTRY;

#5. EXTRACT THE FIRST THREE CHARACTERS OF EACH COUNTRY'S NAME IN THE TABLE COUNTRY
SELECT COUNTRY_NAME, SUBSTRING(COUNTRY_NAME, 1, 3) AS FIRST_THREE_CHARACTERS FROM COUNTRY;

#6. CONVERT ALL COUNTRY NAMES TO UPPERCASE AND LOWERCASE IN TABLE COUNTRY
#UPPERCASE
SELECT COUNTRY_NAME, UPPER(COUNTRY_NAME) AS COUNTRY_NAME_UPPER FROM COUNTRY;

#LOWERCASE
SELECT COUNTRY_NAME, LOWER(COUNTRY_NAME) AS COUNTRY_NAME_LOWER FROM COUNTRY;
